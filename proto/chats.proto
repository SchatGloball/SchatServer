syntax="proto3";


service ChatsRpc {
  rpc FetchAllChats (RequestDto) returns (ListChatsDto);
  rpc CreateChat (ChatDto) returns (ResponseDto);
  rpc EditGroupChat (ChatDto) returns (ResponseDto);
  rpc DeleteChat (ChatDto) returns (ResponseDto);
  rpc FetchChat (ChatDto) returns (ChatDto);
  rpc SendMessage (MessageDto) returns (ResponseDto);
  rpc DeleteMessage (MessageDto) returns (ResponseDto);
  rpc ListenEvent (RequestDto) returns (stream UpdateDTO);
  rpc UpdateApp (UpdateAppReq) returns (UpdateAppRes);
  rpc Notification (RequestDto) returns (ResponseDto);
  rpc SearchMessage (SearchRequestDto) returns (ChatDto);
  rpc ForwardMessage (ChatDto) returns (ResponseDto);
  rpc ReactionMessage (ReactionMessageDto) returns (ResponseDto);
  rpc DeleteReactionMessage (ReactionMessageDto) returns (ResponseDto);
}

message RequestDto
{}

message SearchRequestDto
{
  string searchRequest = 1;
  ChatDto chat = 2;
}

message MemberDto
{
  string member_username = 1;
  oneof optional_member
  {
    string member_image= 2;
  }
}


message ListChatsDto
{
  repeated ChatDto chats = 1;
}

message ChatDto
{
  int32 id =1;
  string name =2;
  string author_id =3;
  repeated MemberDto members = 6;
  repeated MessageDto messages = 4;
  bytes image = 7;
  oneof optional_chat
  {
    string chat_image = 5;
  }
}

message MessageDto
{
  int32   id = 1;
  string body = 2;
  int32 author_id = 3;
  int32 chat_id = 4;
  string author_name = 5;
  bool delivered = 6;
  repeated bytes data = 7;
  repeated string content = 8;
  int32 sticker_content = 9;
  repeated ReactionMessageDto reaction = 11;
  bool forwarded = 12;
  string originalAuthor = 13;
  string originalDate = 14;

  oneof optional_message
  {
    string date_message = 10;
  }
}


message ReactionMessageDto
{
  int32 id = 1;
  string body = 2;
  int32 author_id = 3;
  string author_name = 4;
  int32 messageId = 5;
  int32 sticker_content = 6;
  oneof optional_message
  {
    string dateReaction = 7;
  }
}

message ResponseDto{
  string message = 1;
}

message UpdateDTO
{
  ChatDto chat = 1;
}


message UpdateAppReq
{
  int32   version = 1;
  string platform = 2;
}


message UpdateAppRes
{
  string name = 1;
  bytes data = 2;
}
